# 📊 TAU2 엑셀 보고서 가이드

> **FAIL 원인 3분 만에 찾기**

---

## 🎯 TL;DR

```
FAIL 발견 → F열(RewardBasis) 확인 → 해당 "매칭 상세" 컬럼 확인!
```

| RewardBasis | 도메인 | 확인할 컬럼 |
|-------------|--------|-------------|
| `[DB, COMMUNICATE]` | airline, retail | **P열** (DB), **Q열** (ACTION) |
| `[ENV_ASSERTION]` | telecom | **R열** (ENV_ASSERTION) |

---

## 📋 컬럼 맵 (A~Z)

### 🔹 식별 & 결과 (A~E)

| 열 | 이름 | 설명 |
|:--:|------|------|
| **A** | Result | `PASS` / `FAIL` |
| **B** | Model | 모델명 |
| **C** | Domain | retail / airline / telecom |
| **D** | TaskIdx | 태스크 번호 (1~30) |
| **E** | Reward | 점수 (1.0 = PASS) |

### 🔹 정답 (GT) (F~K)

| 열 | 이름 | 설명 |
|:--:|------|------|
| **F** | RewardBasis | 채점 축 (`[DB, COMMUNICATE]` 등) |
| **G** | GT Actions | 필수 액션 상세 |
| **H** | GT 필수툴 | 툴 이름만 |
| **I** | GT env_assertions | 환경 조건 (telecom) |
| **J** | GT NL Assertions | 자연어 설명 (참고용) |
| **K** | GT Communicate | 필수 전달 값 |

### 🔹 모델 행동 (L~O)

| 열 | 이름 | 설명 |
|:--:|------|------|
| **L** | CalledTools | 호출한 툴 목록 |
| **M** | MissingTools | 누락된 필수 툴 |
| **N** | Model 최종응답 | 사용자에게 한 말 |
| **O** | COMMUNICATE 관련 | GT 값이 포함된 메시지 |

### 🔹 평가 상세 ⭐ (P~R)

| 열 | 이름 | 내용 |
|:--:|------|------|
| **P** | DB 매칭 상세 | `✅ DB 일치` / `❌ DB 불일치` |
| **Q** | ACTION 매칭 상세 | 각 액션별 `✅` / `❌` |
| **R** | ENV 매칭 상세 | 각 assertion별 `✅` / `❌` |

### 🔹 실패 원인 (S~U)

| 열 | 이름 | 설명 |
|:--:|------|------|
| **S** | 깨진 Actions | 매칭 안 된 GT Actions |
| **T** | 깨진 env_assertions | 실패한 환경 조건 |
| **U** | DB 불일치 | 일치/불일치/N/A |

### 🔹 세부 점수 (V~Y)

| 열 | 이름 | 값 |
|:--:|------|-----|
| **V** | RB_DB | 0 또는 1 |
| **W** | RB_COMMUNICATE | 0 또는 1 |
| **X** | RB_ACTION | 0 또는 1 |
| **Y** | RB_ENV_ASSERTION | 0 또는 1 |

### 🔹 종료 (Z)

| 열 | 이름 | 설명 |
|:--:|------|------|
| **Z** | Termination | user_stop, max_turns 등 |

---

## 🔍 평가 흐름 (tau2 철학)

### 1️⃣ COMMUNICATE

```
┌─────────────────────────────────────────────────────────┐
│  K열: GT Communicate                                    │
│  예: ['327', '1000', '44']                              │
└─────────────────┬───────────────────────────────────────┘
                  ↓
         전체 대화에서 검색
         (substring, 대소문자 무시, 쉼표 제거)
                  ↓
┌─────────────────────────────────────────────────────────┐
│  O열: COMMUNICATE 관련 응답                              │
│  예: [포함: '327', '1000'] You have $198...             │
└─────────────────┬───────────────────────────────────────┘
                  ↓
         ┌───────┴───────┐
         ↓               ↓
    모든 값 있음     값 누락
         ↓               ↓
    W열 = 1 ✅      W열 = 0 ❌
```

### 2️⃣ DB

```
┌─────────────────────────────────────────────────────────┐
│  G열: GT Actions 실행 → Golden DB Hash                  │
└─────────────────┬───────────────────────────────────────┘
                  ↓
         Hash 비교 (agent_db + user_db)
                  ↓
┌─────────────────────────────────────────────────────────┐
│  모델 tool_calls 실행 → Predicted DB Hash               │
└─────────────────┬───────────────────────────────────────┘
                  ↓
         ┌───────┴───────┐
         ↓               ↓
     Hash 일치       Hash 불일치
         ↓               ↓
┌────────────────┐ ┌────────────────┐
│ P열: ✅ DB 일치 │ │ P열: ❌ DB 불일치│
│ V열 = 1        │ │ V열 = 0        │
└────────────────┘ └────────────────┘
```

### 3️⃣ ACTION

```
┌─────────────────────────────────────────────────────────┐
│  G열: GT Actions                                        │
│  예: get_user_details(...), cancel_reservation(...)     │
└─────────────────┬───────────────────────────────────────┘
                  ↓
         모델 tool_calls와 비교
                  ↓
┌─────────────────────────────────────────────────────────┐
│  Q열: ACTION 매칭 상세                                   │
│  ✅ get_user_details(user_id=xxx)                       │
│  ❌ cancel_reservation(id=yyy)                          │
└─────────────────┬───────────────────────────────────────┘
                  ↓
         ┌───────┴───────┐
         ↓               ↓
    모든 액션 ✅     ❌ 있음
         ↓               ↓
    X열 = 1 ✅      X열 = 0 ❌
```

### 4️⃣ ENV_ASSERTION

```
┌─────────────────────────────────────────────────────────┐
│  I열: GT env_assertions                                 │
│  예: assert_internet_speed(expected_speed=200)          │
└─────────────────┬───────────────────────────────────────┘
                  ↓
         Predicted Environment에서 실행
                  ↓
┌─────────────────────────────────────────────────────────┐
│  R열: ENV_ASSERTION 매칭 상세                            │
│  ✅ assert_mobile_data_status(expected_status=True)     │
│  ❌ assert_internet_speed(expected_speed=200)           │
└─────────────────┬───────────────────────────────────────┘
                  ↓
         ┌───────┴───────┐
         ↓               ↓
   모든 assertion ✅   ❌ 있음
         ↓               ↓
    Y열 = 1 ✅      Y열 = 0 ❌
```

---

## ❓ FAQ

| 질문 | 답변 |
|------|------|
| **GT Communicate가 null인데 W열=1?** | 평가할 GT 없으면 자동 PASS (tau2 철학) |
| **ACTION 점수가 안 나오는데?** | RewardBasis에 ACTION 없으면 채점 안 함 |
| **다른 툴로 같은 결과면?** | DB Hash만 같으면 PASS (결과 기반) |
| **NL Assertions는 채점에 영향?** | 대부분 참고용, 채점 안 됨 |

---

## 📌 빠른 참조 카드

### FAIL 디버깅 순서

```
┌─────────────────────────────────────────────────────────┐
│  1. A열 확인: FAIL                                      │
│  2. F열 확인: RewardBasis = ?                           │
│                                                         │
│  ┌─────────────────────┬─────────────────────┐         │
│  │ [DB, COMMUNICATE]   │ [ENV_ASSERTION]     │         │
│  │    ↓                │    ↓                │         │
│  │ airline/retail      │ telecom             │         │
│  │    ↓                │    ↓                │         │
│  │ P열: DB 매칭        │ R열: ENV 매칭       │         │
│  │ Q열: ACTION 매칭    │ Y열: RB_ENV         │         │
│  │ V열: RB_DB          │                     │         │
│  │ W열: RB_COMMUNICATE │                     │         │
│  └─────────────────────┴─────────────────────┘         │
│                                                         │
│  3. ❌ 표시된 항목이 실패 원인!                          │
└─────────────────────────────────────────────────────────┘
```

### RB 점수 해석

| RB 점수 | 의미 | 확인할 컬럼 |
|---------|------|-------------|
| **V=0** | DB 불일치 | P열, S열 |
| **W=0** | 필수 정보 미전달 | K열, O열 |
| **X=0** | 필수 액션 누락 | Q열, S열 |
| **Y=0** | 환경 조건 미충족 | R열, T열 |

---

## 📊 예시

### Airline FAIL

| 컬럼 | 값 | 해석 |
|:----:|-----|------|
| A | FAIL | 실패 |
| F | `[DB, COMMUNICATE]` | DB와 안내 채점 |
| G | `cancel_reservation(...)` | 취소 필요 |
| P | ❌ DB 불일치 | DB가 다름 |
| Q | ❌ cancel_reservation | 취소 안 함 |
| V | 0 | DB 실패 |

**💡 원인**: `cancel_reservation` 미호출 → DB 불일치

### Telecom FAIL

| 컬럼 | 값 | 해석 |
|:----:|-----|------|
| A | FAIL | 실패 |
| F | `[ENV_ASSERTION]` | 환경 조건 채점 |
| I | `assert_internet_speed(200)` | 속도 200 필요 |
| R | ❌ assert_internet_speed | 속도 미달 |
| Y | 0 | ENV 실패 |

**💡 원인**: 네트워크 속도 미달

---

<div align="center">

**매칭 상세 컬럼(P/Q/R)을 보면 실패 원인이 한눈에!** 🔍

</div>
